# â“ ì¥ê³  ëª¨ë¸ì´ ë­ì„ â“

ë©”íƒ€ ë°ì´í„°ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ë ˆì´ì•„ì›ƒì¸ ì•„ì£¼ ì¤‘ìš”í•œ ì—­í• ì„ í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

> ğŸ§ **ì¥ê³ ì˜ ì² í•™**
> ëª¨ë¸ì€ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê¸° ìœ„í•œ ë°ì´í„°ì˜ ê¸°ì´ˆì…ë‹ˆë‹¤. ëª¨ë¸ì€ ì €ì¥í•  ë°ì´í„°ì˜ ì¤‘ìš”í•œ í•„ë“œì™€ ë°ì´í„° í˜•ì‹ ë“±ì„ ê°€ì§‘ë‹ˆë‹¤.
>
> ëª¨ë¸ì€ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. `Ruby On Rails`ì™€ëŠ” ë‹¤ë¥´ê²Œ ëª¨ë¸ íŒŒì¼ì„ í†µí•´ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ë§Œë“­ë‹ˆë‹¤.  
> ê¸°ë³¸ì ìœ¼ë¡œ ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ëª¨ë¸ì— ë§ì¶° ì—…ë°ì´íŠ¸ë¥¼ í•˜ê¸° ìœ„í•œ ê¸°ë¡ ì •ë„ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ§‘ğŸ»â€ğŸ’» ëª¨ë¸ ì‘ì„±í•˜ê¸°...

ë‹¨ìˆœí•œ íˆ¬í‘œ ì•±ì„ ìœ„í•´ì„œ `Question`ê³¼ `Choice`ë¼ëŠ” ëª¨ë¸ì„ ë§Œë“¤ì–´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

A. `Question` ëª¨ë¸ì€ ì§ˆë¬¸ê³¼ ê³µê°œ ë‚ ì§œ í•„ë“œë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
B. `Choice` ëª¨ë¸ì€ í•˜ë‚˜ì˜ `Question` ëª¨ë¸ê³¼ ê´€ê³„ê°€ ìˆìŠµë‹ˆë‹¤.

### ğŸ¤” Modelì˜ Field â“

ìµœì¢…ì ìœ¼ë¡œ ì„¤ê³„í•˜ê¸° ì „ì— ì¥ê³ ì˜ ëª¨ë¸(db)ì—ëŠ” ë‹¤ì–‘í•œ í•„ë“œê°€ ì¡´ì¬í•©ë‹ˆë‹¤.

1. **AutoField** : ID(pk)ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ìë™ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” `IntegerField` ì…ë‹ˆë‹¤.
   ì§ì ‘ ì‚¬ìš©í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ëª¨ë¸ì˜ ê¸°ë³¸í‚¤ í•„ë“œëŠ” ë³„ë„ë¡œ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.
2. **CharField** : ì œí•œëœ ë¬¸ìì—´ í•„ë“œ íƒ€ì…. ìµœëŒ€ ê¸¸ì´ë¥¼ max_length ì˜µì…˜ì— ì§€ì •í•´ì•¼ ë©ë‹ˆë‹¤.

   ë¬¸ìì—´ì˜ íŠ¹ë³„í•œ ìš©ë„ì— ë”°ë¼ CharFieldì˜ íŒŒìƒí´ë˜ìŠ¤ë¡œì„œ, ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì²´í¬ë¥¼ í•˜ëŠ” EmailField, IP ì£¼ì†Œë¥¼ ì²´í¬ë¥¼ í•˜ëŠ” GenericIPAddressField ë“±ì´ ìˆìŠµë‹ˆë‹¤.

3. **TexTField** : ëŒ€ìš©ëŸ‰ ë¬¸ìì—´ì„ ê°–ëŠ” í•„ë“œì…ë‹ˆë‹¤.
4. **BooleanField** : true/false í•„ë“œ. Nullì„ í—ˆìš©í•˜ê¸° ìœ„í•´ì„œëŠ” NullBooleanFieldë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

ìœ„ì™€ ê°™ì€ í•„ë“œ íƒ€ì… í´ë˜ìŠ¤ ì´ì™¸ì—, DJango í”„ë ˆì„ì›Œí¬ëŠ” í…Œì´ë¸” ê°„ í˜¹ì€ í•„ë“œ ê°„ ê´€ê³„(Relationship)ì„ í‘œí˜„í•˜ê¸° ìœ„í•´ ForeignKey, ManyToManyFiedl, OneToOneField í´ë˜ìŠ¤ë¥¼ ë˜í•œ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  ì´ ë°–ì—ë„ ë‹¤ì–‘í•œ í•„ë“œë“¤ì´ ìˆìœ¼ë©° ë” í™•ì¸í•˜ê³  ì‹¶ìœ¼ì‹œë©´ ì•„ë˜ ë§í¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.

> [<a href="https://docs.djangoproject.com/en/5.0/ref/forms/fields/#booleanfield">[Built-in Field classes]</a>

## âœ¨ ëª¨ë¸ì„ ë§Œë“¤ë³´ì â—ï¸

```python
from  django.db import models

class Question(models.Model):
    question_text = models.CharField(max_length=200)
    pub_date = models.DateTimeField('date published')

class Choice(models.Model):
    question = models.ForeignKey(Question, on_delete=models.CASCADE)
    choice_text = models.CharField(max_length=200)
    votes = models.IntegerField(default=0)
```

ê° ëª¨ë¸ì€ `django.db.models.Model` ëª¨ë¸ì˜ ì„œë¸Œ ëª¨ë¸ì…ë‹ˆë‹¤. ex) `Question`, `Choice`  
ê° ëª¨ë¸ì€ í´ë˜ìŠ¤ ë³€ìˆ˜ë¥¼ í¬í•¨í•˜ê³ , ê°ê°ì˜ í´ë˜ìŠ¤ ë³€ìˆ˜ëŠ” ëª¨ë¸ ë°ì´í„°ê°€ ì €ì¥ë  ë°ì´í„°ë² ì´ìŠ¤ì˜ í•„ë“œì™€ ê°™ìŠµë‹ˆë‹¤.  
ë°ì´í„°ë² ì´ìŠ¤ì˜ í•„ë“œëŠ” ëª¨ë¸ í´ë˜ìŠ¤ì•ˆì— ì •ì˜ë˜ëŠ” `Field` í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ì™€ ê°™ìŠµë‹ˆë‹¤.

ex) ìºë¦­í„° í•„ë“œë¥¼ ìœ„í•œ `CharField`, ë‚ ì§œë¥¼ ìœ„í•œ `DateTimeField` ì´ê²ƒë“¤ì´ ì¥ê³ ì—ê²Œ ê° í•„ë“œì— ì–´ë–¤ í˜•ì‹ì— ë°ì´í„°ê°€ ì €ì¥ë  ê²ƒì¸ì§€ ì•Œë ¤ì¤ë‹ˆë‹¤.

ForeignKeyë¥¼ ì‚¬ìš©í•˜ì—¬ ë‘ í´ë˜ìŠ¤ê°„ì— ê´€ê³„ë¥¼ ì •ì˜í•œ ê²ƒì„ ì•Œ ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ°ì‹ìœ¼ë¡œ ì¥ê³ ì—ê²Œ ê° Choice í´ë˜ìŠ¤ê°€ í•˜ë‚˜ì˜ Question. í´ë˜ìŠ¤ì™€ ê´€ê³„ê°€ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì¤ë‹ˆë‹¤.

## ğŸƒâ€â™€ï¸ ëª¨ë¸ì˜ í™œì„±í™”

ë‹¤ìŒê³¼ ê°™ì€ ëª‡ ì¤„ ì•ˆë˜ëŠ” ëª¨ë¸ ì½”ë“œëŠ” ì¥ê³ ì—ê²Œ ì•„ì£¼ ë§ì€ ì •ë³´ë¥¼ ì•Œë ¤ ì¤ë‹ˆë‹¤. ì´ ì½”ë“œë¥¼ í†µí•´ ì¥ê³ ëŠ” ì•„ë˜ì™€ ê°™ì€ ê¸°ëŠ¥ë“¤ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì´ ì•±ì˜ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„±(`CREATE TABLE` statements)
- Question ê³¼ Choice ì˜¤ë¸Œì íŠ¸ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ìˆëŠ” Python-database-access API ìƒì„±

### ğŸ¤” ì–´ë–»ê²Œ?

> ì¥ê³  ì•±ì€ **ëª¨ë“ˆì‹** ì…ë‹ˆë‹¤. ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìœ¼ë©°, ë‹¤ë¥¸ ì‚¬ëŒë“¤ì—ê²Œ íŒ¨í‚¤ì§€ë¡œì¨ ì œê³µí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

`/settings.py` íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•´ì¤ë‹ˆë‹¤. <a href="https://docs.djangoproject.com/en/1.10/ref/settings/#std:setting-INSTALLED_APPS">`INSTALLED_APPS`</a> ì…‹íŒ…ì— `'polls.apps.PollsConfig'`ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€í•˜ì—¬ ì£¼ì‹­ì‹œì˜¤.

```python
INSTALLED_APPS = [
    'polls.apps.PollsConfig',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]
```

`INSTALLED_APPS`ì— ì¶”ê°€í•œ `'polls.apps.PollsConfig'` í´ë˜ìŠ¤ëŠ” `polls/apps.py` íŒŒì¼ì— ìˆëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤. ì´ íŒŒì¼ì€ `polls` ì•± ìƒì„±ì‹œ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§€ëŠ” íŒŒì¼ë¡œ ë”°ë¡œ ë§Œë“¤ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

ì´ì œ ì¥ê³ ì—ê²Œ `polls` appì´ ì„¤ì¹˜ë˜ì–´ ìˆìŒì„ ì•Œë ¤ ì£¼ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”
`$ python manage.py makemigrations polls`

ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.

```lua
Migrations for 'polls':
  polls/migrations/0001_initial.py:
    - Create model Choice
    - Create model Question
    - Add field question to choice
```

![Alt text](./img/makemigrations.png)

`makemigrations`, ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ì¥ê³ ì—ê²Œ ìƒˆë¡œ ì¶”ê°€í•œ íŒŒì¼ì´ë‚˜ ë³€ê²½ëœ íŒŒì¼ì´ ìˆìŒì„ ì•Œë ¤ì£¼ê³ , ë³€ê²½ëœ ë‚´ìš©ì„ migration íŒŒì¼ë¡œì¨ ì €ì¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.  
**ë§ˆì´ê·¸ë ˆì´ì…˜** ì€ ëª¨ë¸ì˜ ë³€ê²½ë‚´ìš©ì´ ë””ìŠ¤í¬ìƒì— ì €ì¥ë˜ëŠ” ë‹¨ìˆœí•œ íŒŒì¼ì…ë‹ˆë‹¤. ë˜í•œ ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ í•„ìš”ì— ë”°ë¼ ì§ì ‘ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì´ ë§Œë“¤ì–´ ì¡Œì§€ë§Œ, ì•„ì§ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ë§Œë“¤ì§€ëŠ” ì•Šì•˜ìŠµë‹ˆë‹¤.  
ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ìë™ìœ¼ë¡œ ê´€ë¦¬í•´ì£¼ëŠ” ëª…ë ¹ì–´ê°€ ìˆëŠ”ë° ê·¸ê²ƒì´ <a href="https://docs.djangoproject.com/en/1.10/ref/django-admin/#django-admin-migrate">`migrate`</a> ì…ë‹ˆë‹¤.

<a href="https://docs.djangoproject.com/en/1.10/ref/django-admin/#django-admin-sqlmigrate">`sqlmigrate`</a> ëª…ë ¹ì–´ëŠ” ì‹¤ì œë¡œ SQL ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì§€ëŠ” ì•Šê³  ì‹¤í–‰ë  ë‚´ìš©ë§Œì„ ë³´ì—¬ì¤ë‹ˆë‹¤.  
ì´ ëª…ë ¹ì–´ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ë¦„ì„ íŒŒë¼ë©”í„°ë¡œ ë°›ê³  ì‹¤í–‰ë  SQLì„ ë¦¬í„´í•˜ì—¬ ì¤ë‹ˆë‹¤.

`$ python manage.py sqlmigrate polls 0001`

ê·¸ëŸ¼ ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```lua
BEGIN;
--
-- Create model Question
--
CREATE TABLE "polls_question" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "question_text" varchar(200) NOT NULL, "pub_date" date NOT NULL);
--
-- Create model Choice
--
CREATE TABLE "polls_choice" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "choice_text" varchar(200) NOT NULL, "votes" integer NOT NULL, "question_id" bigint NOT NULL REFERENCES "polls_question" ("id") DEFERRABLE INITIALLY DEFERRED);
CREATE INDEX "polls_choice_question_id_c5b4b260" ON "polls_choice" ("question_id");
COMMIT;
```

## ğŸ¤” ë§ˆì§€ë§‰ìœ¼ë¡œ

ë§ˆì§€ë§‰ìœ¼ë¡œ `$ python mangae.py migrate`ë¥¼ í•œ ë²ˆë” í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•ŠìŒë©´ shellì„ ìˆ˜ì •í•  ë•Œ `OperationalError: no such table: polls_question` ì´ëŸ° ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```lua
$ python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, polls, sessions
Running migrations:
  Rendering model states... DONE
  Applying polls.0001_initial... OK
```
